---
import BaseLayout from "~/layouts/base-layout.astro";
import { getLangFromUrl, useTranslations } from "~/i18n/utils";
import { DOWNLOAD_TARGETS } from "~/config/downloads";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const winRecommended = DOWNLOAD_TARGETS.find((x) => x.id === "win-recommended");
const winClassic = DOWNLOAD_TARGETS.find((x) => x.id === "win-classic");

const DOWNLOAD_NEW_URL: string = winRecommended?.options?.[0]?.url ?? "#";
const DOWNLOAD_LEGACY_URL: string = winClassic?.options?.[0]?.url ?? "#";

const isNewDownloadAvailable = DOWNLOAD_NEW_URL !== "#";
const isLegacyDownloadAvailable = DOWNLOAD_LEGACY_URL !== "#";
---

<BaseLayout
  title={t("download.title")}
  description={t("download.description")}
  lang={lang}
>
  <section class="hero-shell">
    <div class="hero-glow" aria-hidden="true"></div>

    <header class="space-y-6 text-center">
      <h1 class="sr-only">{t("download.heading")}</h1>
      <p class="gradient-text text-5xl font-extrabold tracking-tight sm:text-6xl" aria-hidden="true">
        {t("download.heading")}
      </p>
      <p class="mx-auto max-w-3xl text-base text-offset sm:text-lg">
        {t("download.lead")}
      </p>
      <div class="flex flex-wrap justify-center gap-4 pt-2">
        <a
          class:list={[
            "btn rounded-full border border-default bg-offset px-6 py-3 text-sm font-semibold",
            !isNewDownloadAvailable && "pointer-events-none opacity-50",
          ]}
          href={isNewDownloadAvailable ? DOWNLOAD_NEW_URL : undefined}
          target={isNewDownloadAvailable ? "_blank" : undefined}
          rel={isNewDownloadAvailable ? "noopener noreferrer" : undefined}
          aria-disabled={!isNewDownloadAvailable}
        >
          {t("download.cta.new")}
        </a>
        <a
          class:list={[
            "btn rounded-full border border-default px-6 py-3 text-sm font-semibold",
            !isLegacyDownloadAvailable && "pointer-events-none opacity-50",
          ]}
          href={isLegacyDownloadAvailable ? DOWNLOAD_LEGACY_URL : undefined}
          target={isLegacyDownloadAvailable ? "_blank" : undefined}
          rel={isLegacyDownloadAvailable ? "noopener noreferrer" : undefined}
          aria-disabled={!isLegacyDownloadAvailable}
        >
          {t("download.cta.legacy")}
        </a>
      </div>
    </header>

    <section class="mt-12 grid gap-6 md:grid-cols-2">
      <article class="glass-card space-y-4">
        <h2 class="text-xl font-bold sm:text-2xl">{t("download.contents.title")}</h2>
        <ul class="list-disc space-y-2 pl-6 text-offset">
          <li>{t("download.contents.b1")}</li>
          <li>{t("download.contents.b2")}</li>
          <li>{t("download.contents.b3")}</li>
        </ul>
      </article>

      <article class="glass-card space-y-3">
        <h2 class="text-xl font-bold sm:text-2xl">{t("download.tips.title")}</h2>
        <p class="text-offset">{t("download.tips.text")}</p>
      </article>
    </section>
  </section>
</BaseLayout>


